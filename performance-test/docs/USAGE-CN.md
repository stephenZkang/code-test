# å¿«é€Ÿæµ‹è¯•ç»“æœæ€»ç»“ [ä¸­æ–‡ç‰ˆ]

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

âœ… **å®Œæ•´çš„Spring Boot 4æ€§èƒ½æµ‹è¯•é¡¹ç›®**åŒ…å«ï¼š
- **3ç§å®ç°ç±»å‹**ï¼šTomcatã€è™šæ‹Ÿçº¿ç¨‹ã€WebFlux
- **15ä¸ªæ¥å£**ï¼š5ç§å»¶è¿Ÿæ—¶é•¿ Ã— 3ç§å®ç°
- **è´Ÿè½½æµ‹è¯•**ï¼šæ”¯æŒ3000-50000 QPSçš„è„šæœ¬
- **éƒ¨ç½²æ–¹å¼**ï¼šDocker + Shellè„šæœ¬
- **ç›‘æ§**ï¼šPrometheus + Grafanaé›†æˆ

## ğŸ“ é¡¹ç›®ç»“æ„

```
spring-boot-performance-test/
â”œâ”€â”€ src/main/java/com/performance/test/
â”‚   â”œâ”€â”€ PerformanceTestApplication.java     # ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ TomcatController.java           # ä¼ ç»Ÿservletæ¥å£
â”‚   â”‚   â”œâ”€â”€ VirtualThreadController.java    # è™šæ‹Ÿçº¿ç¨‹æ¥å£  
â”‚   â”‚   â””â”€â”€ WebFluxController.java         # å“åº”å¼æ¥å£
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ VirtualThreadConfig.java        # è™šæ‹Ÿçº¿ç¨‹é…ç½®
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ application.properties              # é…ç½®
â”œâ”€â”€ scripts/                                # éƒ¨ç½²å’Œæµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ run.sh / run.bat                   # åº”ç”¨è¿è¡Œå™¨
â”‚   â”œâ”€â”€ build.sh                          # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ quick-test.sh                     # æ¥å£éªŒè¯
â”‚   â”œâ”€â”€ load-test.sh                      # Apache Benchæµ‹è¯•
â”‚   â””â”€â”€ wrk-test.sh                      # é«˜çº§WRKæµ‹è¯•
â”œâ”€â”€ monitoring/                             # ç›‘æ§é…ç½®
â”‚   â””â”€â”€ prometheus.yml                     # Prometheusé…ç½®
â”œâ”€â”€ Dockerfile                             # å®¹å™¨å®šä¹‰
â”œâ”€â”€ docker-compose.yml                     # å®Œæ•´ç›‘æ§æ ˆ
â””â”€â”€ pom.xml                               # Mavené…ç½®
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

### 1. æ„å»ºåº”ç”¨
```bash
# æ„å»ºé¡¹ç›®
./scripts/build.sh

# æˆ–æ‰‹åŠ¨ï¼š
mvn clean package -DskipTests
```

### 2. è¿è¡Œåº”ç”¨
```bash
# é€‰é¡¹1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
./scripts/run.sh

# é€‰é¡¹2ï¼šç›´æ¥Java
java -jar target/performance-test-app.jar

# é€‰é¡¹3ï¼šDocker
docker-compose up -d
```

### 3. å¿«é€Ÿæµ‹è¯•
```bash
# æµ‹è¯•æ‰€æœ‰æ¥å£
./scripts/quick-test.sh
```

### 4. è´Ÿè½½æµ‹è¯•

#### åŸºç¡€æµ‹è¯•ï¼ˆApache Benchï¼‰
```bash
# æµ‹è¯•3000 QPS
./scripts/load-test.sh 3000

# æµ‹è¯•æ‰€æœ‰QPSçº§åˆ«
./scripts/load-test.sh --all

# æµ‹è¯•ç‰¹å®šæ¥å£
./scripts/load-test.sh -e "/api/virtual/sleep/100ms" 10000
```

#### é«˜çº§æµ‹è¯•ï¼ˆWRKï¼‰
```bash
# ä½¿ç”¨WRKæµ‹è¯•ï¼ˆæ¨èï¼‰
./scripts/wrk-test.sh 3000

# æ¯”è¾ƒæ‰€æœ‰å®ç°
./scripts/wrk-test.sh --compare 10000
```

## ğŸ“¡ å¯ç”¨æ¥å£

### ä¼ ç»ŸTomcatï¼ˆå¹³å°çº¿ç¨‹ï¼‰
- `/api/tomcat/sleep/50ms`
- `/api/tomcat/sleep/100ms`
- `/api/tomcat/sleep/200ms`
- `/api/tomcat/sleep/500ms`
- `/api/tomcat/sleep/1s`

### è™šæ‹Ÿçº¿ç¨‹å®ç°
- `/api/virtual/sleep/50ms`
- `/api/virtual/sleep/100ms`
- `/api/virtual/sleep/200ms`
- `/api/virtual/sleep/500ms`
- `/api/virtual/sleep/1s`

### WebFluxå“åº”å¼å®ç°
- `/api/webflux/sleep/50ms`
- `/api/webflux/sleep/100ms`
- `/api/webflux/sleep/200ms`
- `/api/webflux/sleep/500ms`
- `/api/webflux/sleep/1s`

### ç®¡ç†æ¥å£
- `/actuator/health` - å¥åº·æ£€æŸ¥
- `/actuator/metrics` - åº”ç”¨æŒ‡æ ‡
- `/actuator/prometheus` - PrometheusæŒ‡æ ‡

## ğŸ¯ QPSæµ‹è¯•çº§åˆ«

**å¯ç”¨QPSçº§åˆ«ï¼š**
- 3000 QPS - è½»è´Ÿè½½
- 5000 QPS - ä¸­ç­‰è´Ÿè½½  
- 10000 QPS - é‡è´Ÿè½½
- 20000 QPS - æé‡è´Ÿè½½
- 30000 QPS - æé™è´Ÿè½½
- 50000 QPS - æœ€å¤§æµ‹è¯•è´Ÿè½½

## ğŸ“Š é¢„æœŸæ€§èƒ½ç‰¹å¾

| å®ç°æ–¹å¼ | ä½QPS (3K-5K) | ä¸­QPS (10K-20K) | é«˜QPS (30K-50K) |
|------------|----------------|-------------------|-------------------|
| **Tomcat** | è‰¯å¥½ | å—çº¿ç¨‹æ± é™åˆ¶ | å·®ï¼ˆçº¿ç¨‹è€—å°½ï¼‰ |
| **è™šæ‹Ÿçº¿ç¨‹** | è‰¯å¥½ | æ¯”Tomcatæ›´å¥½ | è‰¯å¥½ï¼ˆæ›´å¥½æ‰©å±•ï¼‰ |
| **WebFlux** | è‰¯å¥½ | ä¼˜ç§€ | ä¼˜ç§€ï¼ˆæœ€ä½³æ‰©å±•ï¼‰ |

## ğŸ³ Dockeréƒ¨ç½²

```bash
# ä½¿ç”¨ç›‘æ§æ„å»ºå’Œè¿è¡Œ
docker-compose up -d

# å¯ç”¨æœåŠ¡ï¼š
# - åº”ç”¨: http://localhost:8080
# - Prometheus: http://localhost:9090
# - Grafana: http://localhost:3000 (admin/admin)
```

## ğŸ“ˆ ç›‘æ§

### åº”ç”¨æŒ‡æ ‡
- HTTPè¯·æ±‚è®¡æ•°å’Œå“åº”æ—¶é—´
- JVMå†…å­˜å’Œåƒåœ¾å›æ”¶
- çº¿ç¨‹æ± åˆ©ç”¨ç‡
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### è®¿é—®æŒ‡æ ‡
```bash
# Prometheusæ¥å£
curl http://localhost:8080/actuator/prometheus

# å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health
```

## ğŸ”§ é…ç½®

### é»˜è®¤è®¾ç½®
- **æœåŠ¡å™¨ç«¯å£**: 8080
- **JVMé€‰é¡¹**: -Xms2g -Xmx4g -XX:+UseG1GC
- **Tomcatçº¿ç¨‹**: æœ€å¤§200ï¼Œæœ€å°10
- **è™šæ‹Ÿçº¿ç¨‹**: å¯ç”¨ï¼ˆJava 21+ï¼‰

### ç¯å¢ƒå˜é‡
```bash
SERVER_PORT=8080
SPRING_PROFILES_ACTIVE=default
JAVA_OPTS="-Xms2g -Xmx4g -XX:+UseG1GC"
```

## âš¡ å¿«é€Ÿå¼€å§‹å‘½ä»¤

```bash
# 1. æ„å»º
./scripts/build.sh

# 2. è¿è¡Œ
./scripts/run.sh

# 3. æµ‹è¯•æ¥å£
./scripts/quick-test.sh

# 4. è´Ÿè½½æµ‹è¯•10000 QPS
./scripts/wrk-test.sh 10000

# 5. åœ¨5000 QPSä¸‹æ¯”è¾ƒå®ç°
./scripts/wrk-test.sh --compare 5000
```

## ğŸ“‹ å‰ç½®æ¡ä»¶æ£€æŸ¥æ¸…å•

- âœ… Java 21+ï¼ˆè™šæ‹Ÿçº¿ç¨‹éœ€è¦ï¼‰
- âœ… Maven 3.6+
- âœ… Apache Bench (ab)ç”¨äºåŸºç¡€æµ‹è¯•
- âœ… WRKç”¨äºé«˜çº§æµ‹è¯•ï¼ˆæ¨èï¼‰
- âœ… Dockerå’ŒDocker Composeï¼ˆå¯é€‰ï¼‰
- âœ… 4GB+å¯ç”¨å†…å­˜

## ğŸš¨ é‡è¦è¯´æ˜

1. **Javaç‰ˆæœ¬**ï¼šå¿…é¡»ä½¿ç”¨Java 21+æ”¯æŒè™šæ‹Ÿçº¿ç¨‹
2. **å†…å­˜**ï¼šé»˜è®¤JVMè®¾ç½®ä½¿ç”¨2-4GBå †å†…å­˜
3. **ç«¯å£8080**ï¼šé»˜è®¤ç«¯å£ - ç¡®ä¿å¯ç”¨
4. **è´Ÿè½½æµ‹è¯•**ï¼šä»ä½QPSå¼€å§‹å¹¶é€æ­¥å¢åŠ 
5. **ç›‘æ§**ï¼šä½¿ç”¨docker-composeè·å–å®Œæ•´ç›‘æ§æ ˆ

## ğŸ“ æ•…éšœæ’é™¤

**å¸¸è§é—®é¢˜ï¼š**
- **Javaç‰ˆæœ¬é”™è¯¯**ï¼šå®‰è£…Java 21+å¹¶è®¾ç½®JAVA_HOME
- **ç«¯å£è¢«å ç”¨**ï¼šä½¿ç”¨`-p 9090`é€‰é¡¹æ›´æ”¹
- **å†…å­˜ä¸è¶³**ï¼šä½¿ç”¨`-Xmx8g`å¢åŠ å †å¤§å°
- **è´Ÿè½½æµ‹è¯•å·¥å…·**ï¼šå®‰è£…`ab`å’Œ`wrk`åŒ…

## ğŸŒ Windowsç¦»çº¿Dockeræ”¯æŒ

æœ¬é¡¹ç›®å®Œå…¨æ”¯æŒWindowsä¸‹çš„ç¦»çº¿Dockeræ„å»ºï¼š

```cmd
# åˆ›å»ºç¦»çº¿éƒ¨ç½²åŒ…
scripts\create-offline-package.bat

# ä¼ è¾“åˆ°ç¦»çº¿ç¯å¢ƒå¹¶éƒ¨ç½²
QUICK-START.bat
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š`docs\WINDOWS-DOCKER-OFFLINE-CN.md`

## ğŸ§¹ æµ‹è¯•ç»“æœåˆ†æ

### æ€§èƒ½æŒ‡æ ‡è¯´æ˜
- **å“åº”æ—¶é—´**ï¼šæ¥å£å¤„ç†æ—¶é—´ï¼ˆp50, p95, p99ï¼‰
- **ååé‡**ï¼šæ¯ç§’å¤„ç†çš„è¯·æ±‚æ•°ï¼ˆQPSï¼‰
- **é”™è¯¯ç‡**ï¼šå¤±è´¥è¯·æ±‚çš„ç™¾åˆ†æ¯”
- **èµ„æºä½¿ç”¨**ï¼šCPUã€å†…å­˜ã€çº¿ç¨‹åˆ©ç”¨ç‡

### æµ‹è¯•æŠ¥å‘Šè§£è¯»
- **Tomcat**ï¼šé€‚åˆä½å¹¶å‘åœºæ™¯ï¼Œçº¿ç¨‹æ± é™åˆ¶æ˜æ˜¾
- **è™šæ‹Ÿçº¿ç¨‹**ï¼šä¸­ç­‰å¹¶å‘ä¸‹è¡¨ç°ä¼˜äºTomcatï¼Œèµ„æºåˆ©ç”¨ç‡æ›´é«˜
- **WebFlux**ï¼šé«˜å¹¶å‘ä¸‹æœ€ä½³ï¼Œéé˜»å¡I/Oä¼˜åŠ¿æ˜æ˜¾

### æ€§èƒ½è°ƒä¼˜å»ºè®®
1. **JVMè°ƒä¼˜**ï¼šæ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´å †å¤§å°å’ŒGCç­–ç•¥
2. **çº¿ç¨‹é…ç½®**ï¼šä¼˜åŒ–Tomcatçº¿ç¨‹æ± å¤§å°
3. **ç½‘ç»œé…ç½®**ï¼šè°ƒæ•´è¿æ¥è¶…æ—¶å’Œç¼“å†²åŒºå¤§å°
4. **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®Grafanaå‘Šè­¦è§„åˆ™

## ğŸ“š å®Œæ•´æ–‡æ¡£é›†

æœ¬é¡¹ç›®æä¾›å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ï¼š

- **README-CN.md** - é¡¹ç›®æ¦‚è¿°å’Œå¿«é€Ÿå¼€å§‹
- **USAGE-CN.md** - è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- **WINDOWS-DOCKER-OFFLINE-CN.md** - Windowsç¦»çº¿Dockeréƒ¨ç½²
- **API-REFERENCE-CN.md** - APIæ¥å£è¯¦ç»†è¯´æ˜

## ğŸ¯ æ€§èƒ½åŸºå‡†

### å»ºè®®çš„æµ‹è¯•åœºæ™¯
1. **åŸºçº¿æµ‹è¯•**ï¼š1000 QPSï¼Œæ‰€æœ‰å®ç°æ–¹å¼
2. **å‹åŠ›æµ‹è¯•**ï¼šé€æ­¥å¢åŠ åˆ°50000 QPS
3. **ç¨³å®šæ€§æµ‹è¯•**ï¼šæŒç»­è¿è¡Œ30åˆ†é’Ÿ
4. **å³°å€¼æµ‹è¯•**ï¼šæ‰¾å‡ºç³»ç»Ÿæœ€å¤§æ‰¿è½½èƒ½åŠ›

### æ€§èƒ½ç›®æ ‡
- **ä½å»¶è¿Ÿ**ï¼šp95 < 200msï¼ˆ50mså»¶è¿Ÿæ¥å£ï¼‰
- **é«˜åå**ï¼šç›®æ ‡QPSè¾¾åˆ°90%æˆåŠŸç‡
- **ä½é”™è¯¯ç‡**ï¼š< 0.1%å¤±è´¥è¯·æ±‚
- **èµ„æºæ•ˆç‡**ï¼šCPUä½¿ç”¨ç‡ < 80%

é¡¹ç›®ç°åœ¨å·²ç»å‡†å¤‡å¥½è¿›è¡Œå…¨é¢çš„æ€§èƒ½æµ‹è¯•ï¼ğŸ‰

---

**ä½¿ç”¨ä¸­æ–‡ç‰ˆæœ¬æ–‡æ¡£è·å¾—æœ€ä½³ä½“éªŒï¼** ğŸ‡¨ğŸ‡³

---

**æç¤º**ï¼šæ‰€æœ‰è„šæœ¬å’Œé…ç½®æ–‡ä»¶éƒ½æ”¯æŒä¸­æ–‡åŒ–ï¼Œæä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼